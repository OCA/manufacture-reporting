<?xml version="1.0" encoding="utf-8" ?>
<!-- Copyright 2017 ForgeFlow S.L.
     License LGPL-3.0 or later (http://www.gnu.org/licenses/lgpl-3.0) -->
<odoo>
    <record id="mrp_bom_current_stock_view_form" model="ir.ui.view">
        <field name="name">mrp.bom.current.stock.form</field>
        <field name="model">mrp.bom.current.stock</field>
        <field name="arch" type="xml">
            <form>
                <p>
                    It is necessary to differentiate between the two types of explosion.
                </p>
                <p>
                    - One Level: Allows you to evaluate what the potential quantity is in the event
                    that only the selected product in particular should be manufactured. In other
                    words, it emulates a manufacturing order.
                </p>
                <p>
                    - All Levels: Allows you to evaluate what is the total potential amount that could
                    be manufactured if all the existing material in the specified locations were used.
                </p>
                <p>
                    As a final comment, it is necessary to indicate that in the event that a component
                    is repeated in different BoMs, it is possible that the potential quantity is not
                    correctly computed since it is not taken into account that if it is being used by
                    a BoM, it cannot be used by another.
                </p>
                <group name="step_1" string="Select product and location to explode">
                    <field name="product_id" domain="[('bom_ids','!=',False)]" />
                    <field name="product_tmpl_id" invisible="1" />
                    <field
                        name="bom_id"
                        domain="['|', ('product_id','=',product_id),
                           '&amp;', ('product_id', 'in', 'product_tmpl_id.product_variant_ids'),
                           ('product_id','=',False)]"
                    />
                    <field name="location_id" />
                    <field name="exclude_location_ids" widget="many2many_tags" />
                    <label for="desired_qty" />
                    <div class="o_row">
                        <field name="desired_qty" />
                        <field
                            name="product_uom_id"
                            class="oe_inline"
                            groups="uom.group_uom"
                        />
                    </div>
                    <field name="explosion_type" widget="radio" />
                </group>
                <footer>
                    <button
                        name="do_explode"
                        type="object"
                        string="Explode"
                        class="oe_highlight"
                    />
                    <button special="cancel" string="Cancel" />
                </footer>
            </form>
        </field>
    </record>
    <record id="mrp_bom_current_stock_view_form2" model="ir.ui.view">
        <field name="name">mrp.bom.current.stock.form2</field>
        <field name="model">mrp.bom.current.stock</field>
        <field name="arch" type="xml">
            <form>
                <group name="step_2" string="Explosion result">
                    <p>Set the source location for every component.</p>
                    <br />
                    <group>
                        <field name="product_id" readonly="1" />
                        <field name="bom_id" readonly="1" />
                        <field
                            name="location_id"
                            readonly="1"
                            attrs="{'invisible': [('location_id', '=', False)]}"
                        />
                        <field
                            name="exclude_location_ids"
                            readonly="1"
                            widget="many2many_tags"
                        />
                        <field name="product_uom_id" groups="uom.group_uom" />
                    </group>
                    <group>
                        <field name="qty_available_in_source_loc" />
                        <field name="potential_qty_rounded" readonly="1" />
                        <field name="desired_qty" readonly="1" />
                        <field name="availability" readonly="1" />
                    </group>
                    <field name="line_ids" nolabel="1" colspan="2">
                        <tree
                            create="0"
                            delete="0"
                            editable="1"
                            decoration-danger="availability=='not_available'"
                        >
                            <field name="bom_level" readonly="1" />
                            <field name="product_id" readonly="1" />
                            <field name="bom_id" readonly="1" />
                            <field name="bom_type" readonly="1" />
                            <field name="product_qty" readonly="1" />
                            <field name="qty_available_in_source_loc" readonly="1" />
                            <field name="potential_qty" readonly="1" />
                            <field
                                name="product_uom_id"
                                groups="uom.group_uom"
                                readonly="1"
                            />
                            <field name="availability" readonly="1" />
                            <field name="parent_bom_id" readonly="1" />
                            <field name="location_id" />
                        </tree>
                    </field>
                </group>
                <footer>
                    <button
                        name="%(mrp_bom_current_stock.action_report_bom_current_stock_pdf)d"
                        type="action"
                        string="Print PDF"
                        class="oe_highlight"
                    />
                    <button
                        name="%(mrp_bom_current_stock.action_report_bom_current_stock_xlsx)d"
                        type="action"
                        string="Export XLSX"
                        class="oe_highlight"
                    />
                    <button name="action_go_back" type="object" string="Go Back" />
                    or
                    <button special="cancel" string="Close" />
                </footer>
            </form>
        </field>
    </record>

    <record id="mrp_bom_current_stock_action" model="ir.actions.act_window">
        <field name="name">BoM Current Stock Explosion</field>
        <field name="res_model">mrp.bom.current.stock</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

    <menuitem
        id="mrp_bom_current_stock_menu"
        action="mrp_bom_current_stock_action"
        parent="mrp.menu_mrp_reporting"
        sequence="50"
    />

</odoo>
